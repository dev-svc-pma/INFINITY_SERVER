--This file is the entity landing table from Oracle.


IF OBJECT_ID('PMR_PowerBI.dbo.INFINITY_ENTITY_RECORD_TYPE_LANDING', 'U') IS NOT NULL
    DROP TABLE PMR_PowerBI.dbo.INFINITY_ENTITY_RECORD_TYPE_LANDING;

SELECT  epb.ID_NUMBER,
epb.HH_ID_NUMBER,
epb.PROSPECT_ID,
rec.RECORD_TYPE_CODE, 
tms_rectype.SHORT_DESC AS RECORD_TYPE_DESC,
rec.XSEQUENCE, 
CONVERT(DATETIME, rec.DATE_ADDED) as SYSTEM_DATE_ADDED,
DATEADD(dd, DATEDIFF(dd, 0, TRY_CONVERT(DATETIME, rec.DATE_ADDED)), 0) as DATE_ADDED,	
CONVERT(DATETIME, rec.DATE_MODIFIED) as SYSTEM_DATE_MODIFIED,
DATEADD(dd, DATEDIFF(dd, 0, TRY_CONVERT(DATETIME, rec.DATE_MODIFIED)), 0) as DATE_MODIFIED,
rec.USER_GROUP,
getdate() as DATE_TABLE_REFRESH



-------
INTO PMR_PowerBI.dbo.INFINITY_ENTITY_RECORD_TYPE_LANDING
--------

FROM AIS_PROD_ORACLE..ADVANCE.ENTITY_RECORD_TYPE rec
LEFT JOIN PMR_PowerBI.dbo.INFINITY_ENTITY_PROSPECT_BRIDGE epb on epb.ID_NUMBER=rec.ID_NUMBER
LEFT JOIN    AIS_PROD_ORACLE..ADVANCE.TMS_RECORD_TYPE tms_rectype ON rec.RECORD_TYPE_CODE = tms_rectype.RECORD_TYPE_CODE
WHERE rec.ID_NUMBER is not null
